<!DOCTYPE html>
<html>
<head>
	<title class="i18n" i18n="sys.config.systitle">批售融资管理系统</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta http-equiv="Cache-Control" content="no-store" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="icon" href="./platform/ibcs/images/favicon-sinosoft.ico" type="image/x-icon">
	
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="./platform/ibcs/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
	<!-- END GLOBAL MANDATORY STYLES -->
	<!-- BEGIN THEME GLOBAL STYLES -->
	<link href="./platform/ibcs/assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
	<link href="./platform/ibcs/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
	<!-- END THEME GLOBAL STYLES -->
	<!-- BEGIN THEME LAYOUT STYLES:tree -->
	<link href="./platform/ibcs/assets/layouts/layout/css/layout.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/assets/layouts/layout/css/themes/default.min.css" rel="stylesheet" type="text/css" id="style_color" />
	<link href="./platform/ibcs/assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
	<!-- END THEME LAYOUT STYLES -->
	<!-- BEGIN SELF-DEFINED LAYOUT STYLES -->
	<link href="./platform/ibcs/css/components-ex.css" rel="stylesheet" type="text/css" />
	<link href="./platform/ibcs/css/common.css" rel="stylesheet" type="text/css" />
	
	
	
	<link href="./platform/ibcs/assets/pages/css/login-4.min.css" rel="stylesheet" type="text/css" />
	<link href="./platform/common/jquery.slider/css/jquery.slider.css" rel="stylesheet" type="text/css"/>
	
	<!-- END PAGE LEVEL SCRIPTS -->
    <style type="text/css">
		.alert-login-error {
			background-color: #fbe1e3;
			border-color: #fbe1e3;
			color: #e73d4a;
		}
</style>

</head>
<body class=" login">
<!-- BEGIN LOGO -->
<div class="logo">
    <!--<a href="index"> -->
        <img src="./platform/ibcs/assets/pages/img/logo-big1bak.png" alt="" /> <!-- </a> -->
</div>
<!-- END LOGO -->
<!-- BEGIN LOGIN -->
<div class="content">
    <!-- BEGIN LOGIN FORM -->
    <form class="login-form" method="post">
        <h3 class="form-title i18n" i18n="common.welcomemsg">批售融资管理系统</h3>
        <div class="alert alert-danger display-hide">
            <button class="close" data-close="alert"></button>
            <span class="i18n" i18n="index.login.user.password"> 请输入用户名密码 </span>
        </div>
        <div class="alert alert-login-error display-hide">
            <button class="close" data-close="alert"></button>
            <!-- 登录失败返回错误信息 -->
            <span> </span>
        </div>
        <div class="form-group">
            <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
            <label class="control-label visible-ie8 visible-ie9 i18n"  i18n="index.login.mailbox.cell">用户名/邮箱/手机号码</label>
            <div class="input-icon">
                <i class="fa fa-user"></i>
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Username" name="username" id="username"/> </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9 i18n"  i18n="index.login.password">密码</label>
            <div class="input-icon">
                <i class="fa fa-lock"></i>
                <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="Password" name="password" id="password"/>
            </div>
        </div>
        <div class="form-group" id="myMsgcodeDiv">
            <!-- <label class="control-label visible-ie8 visible-ie9">短信验证码</label>
            <div class="input-icon">
                <i class="fa fa-user"></i>
                <input style="width: 80%;display:inline-block;" class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="短信验证码" name="msgcode" id="msgcode"/> 
             	<button type="button" class="btn brue" id="my_msgcode_button" onclick="myMsgcodeButton();" style="margin-top: -2.5px;">获取</button>
             </div> -->
        </div>
      
        <div class="form-group">
            <div id="slider1" class="slider" style="margin: 0;"></div>
            <input type="hidden" name="code" id="code" maxlength="6">
            <input type="hidden" id="login_validate_code" value="${login_validate_code}">
        </div>
        <div class="form-actions">
            <label class="checkbox">
                <input type="checkbox" name="remember" id="remember" value="1" /> <span class="i18n" i18n="index.login.remember">Remember me </span>
            </label>
            <label class="checkbox">
                <input type="radio" name="loginRadio" id="loginRadio1" onclick="loginTypeclick('0');"  value="0"/> <span class="i18n" i18n="index.login.flag0">普通登录</span>
            </label>
            <label class="checkbox">
                 <input type="radio" name="loginRadio" id="loginRadio2"  onclick="loginTypeclick('ldap');" value="ldap"/> <span class="i18n" i18n="index.login.flag1">域登录</span>
            </label>
            <div class="input-icon">
            	<!-- <a href="retrieve.html">找回密码</a> -->
            	<button type="submit" name="Submit" class="btn green pull-right i18n" i18n="index.login.submit"> Login </button>
            </div>
        </div>
        <div class="forget-password">
           <label for="password" class="i18n" i18n="index.login.language.choice">语言选择:</label>
     		   <a href="javascript:void(0);" onClick="selectLang('en_US')">EN</a>
     		   <a href="javascript:void(0);" onClick="selectLang('zh_CN')">中文</a>
     		 <!--   <a href="javascript:void(0);" onClick="selectLang('zh_TW')">繁体</a> -->
        </div>
    </form>
</div>












<!-- BEGIN CORE PLUGINS -->
<script src="./js/config.js" type="text/javascript"></script>

<script src="./platform/ibcs/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="./platform/ibcs/assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="./platform/ibcs/assets/global/scripts/app.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/pages/scripts/components-date-time-pickers.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/global/plugins/jquery-validation/localization/messages_zh.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="./platform/ibcs/assets/layouts/layout/scripts/layout.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->
<script type="text/javascript" src="./platform/common/js/jquery.form.js"></script>
<script type="text/javascript" src="./platform/common/js/json2.js"></script>
<script type="text/javascript" src="./platform/common/js/form2json.js"></script>
<script type="text/javascript" src="./platform/common/js/laytpl.js"></script>

<script src="./platform/common/js/jquery.i18n.properties.js" type="text/javascript"></script>

<!-- BEGIN PAGE GLOBAL SCRIPTS -->
<script src="./platform/ibcs/js/common.js" type="text/javascript"></script>


<!-- login -->
<script type="text/javascript" src="./platform/common/js/jquery.cookie.js"></script>
<script type="text/javascript" src="./platform/common/js/login/md5.js"></script>

<!-- END PAGE LEVEL STYLES -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="./platform/ibcs/assets/global/plugins/backstretch/jquery.backstretch.min.js" type="text/javascript"></script>
<script src="./platform/ibcs/assets/pages/scripts/login-4.js" type="text/javascript"></script>
<script src="./platform/common/jquery.slider/js/jquery.slider.min.js" type="text/javascript"></script>
<script src="./platform/common/js/map.js" type="text/javascript"></script>
<script src="./platform/common/js/hx.js" type="text/javascript"></script>

<script type="text/javascript">
    var _uuid=getUUID();
	if(window!=top){
	   top.location.href=location.href;
	}
    jQuery(document).ready(function() {
    	ajax(ctx+"/sys/auth/login/validate/code",{uuid:_uuid},function(result){
    		if(result.success){
    			$("#login_validate_code").val(result.data);
    		}
    	},"",false);
    	$("#slider1").slider({
			callback: function(result) {
				if(result){
					$("#code").val(_hxdec($("#login_validate_code").val()));
				}
			}
		});
    	$(window.document).bind("keydown",function(e){
            // 兼容FF和IE和Opera    
    	    var theEvent = e || window.event;    
    	    var code = theEvent.keyCode || theEvent.which || theEvent.charCode;    
    	    if (code == 13) {    
    	        //回车执行查询
    	        $(".form-actions").find("button[name=\"Submit\"]").click();
            }    
    	});
    	
    	$('[name="remember"]').click(function(){
    		saveLogin();
    	});
    	var username = localStorage.getItem('eas-username');
    	var password = localStorage.getItem('eas-password');
    	var remember = localStorage.getItem('eas-remember');
		var loginType = localStorage.getItem('eas-loginType');//读取用户上次是否使用LDAP登录
    	if(remember){
	    	$("#username").val(username);
	    	$("#password").val(password);
    		$("#uniform-remember span").addClass("checked");
    		$("#remember").prop("checked","checked");
    	}
		if(loginType=='ldap'){
			$("#loginRadio2").prop("checked","checked");
			$("#myMsgcodeDiv").hide();
		}else{
			//默认使用普通登录方式
			$("#loginRadio1").prop("checked","checked");
			$("#myMsgcodeDiv").show();
		}
		$.uniform.update();//刷新uniform

        $(".form-actions").find("button[name=\"Submit\"]").click(function(event){
            //event.preventDefault();
            if($('.login-form').valid()){
            	$('.alert-danger', $('.login-form')).hide();
            	$('.alert-login-error', $('.login-form')).hide();
            	console.log($("#remember").prop("checked"));
            	saveLogin();
            	/**显示和提交的值交换*/
//                 var dataParam=serializeObject($(".login-form"));//参数
            	
            	var loginRadio=$('input:radio[name=loginRadio]:checked').val();
            	localStorage.setItem('eas-loginType', loginRadio);//存储上次登录类型
            	if(loginRadio==undefined || loginRadio=="undefined"){
            		 $('.alert-login-error').children("span").html(_getI18n("index.login.flag.select"));
                 	$('.alert-login-error', $('.login-form')).show();
                 	setTimeout(function(){
                 		$('.alert-login-error').children("span").html("");
                     	$('.alert-login-error', $('.login-form')).hide();
     				},2000);
                 	return;
            	}
            	
            	
            	App.blockUI({
                    boxed: true
                });
            	var userNo=$("#username").val();
        		var password =$("#password").val();
        		if(loginRadio=="ldap"){
        			password=password;
        		}else{
        			if(password.length !=32){//为了判断是从cookie中取的，还是手动输的，
            			password=hex_md5(password);
            		}
        		}
        		
        		
        		
                $.ajax( {
                    type: 'POST',
                    url:ctx+"/sys/auth/login/local",
        			async:true,
        			data:{userNo:userNo,password:password,code:$("#code").val(),organCode:"",uuid:_uuid,flag:loginRadio,msgcode:$("#msgcode").val()},
                    success:function(data) {
                    	var res = (data);
                        console.log(data);
                        if(res.success){
                        	_createToken(res.details);
                        	_createSessionTime(res.result);//登录时间
                            //业务从成功
                            var page_falg=localStorage.getItem('_page_win10');
                            if(page_falg!="undefined"&&page_falg!=null&&page_falg!=""&&page_falg=="indexNav"){
                            	window.location.replace("./indexNav.html");
                            }else if(page_falg!="undefined"&&page_falg!=null&&page_falg!=""&&page_falg=="win10"){
                            	window.location.replace("./indexWin.html");
                            }else if(page_falg!="undefined"&&page_falg!=null&&page_falg!=""&&page_falg=="Mac"){
                            	window.location.replace("./indexMac.html");
                            }else{
                            	window.location.replace("./indexNav.html");
                            }
                        }else{//业务错误
                            $('.alert-login-error').children("span").html(res.msg);
                        	$('.alert-login-error', $('.login-form')).show();
                        	setTimeout(function(){
                        		$('.alert-login-error').children("span").html("");
                            	$('.alert-login-error', $('.login-form')).hide();
            				},2000);
                        }
                        App.unblockUI();
                    },
                    error : function() {
                    	App.unblockUI();
                        alert("网络通信异常。");
                    }
                });
            }
        })

    });

    //将登录信息存到浏览器
	function saveLogin(){
		if($("#remember").prop("checked")){
        	//localStorage.clear();
        	localStorage.setItem('eas-username', $("#username").val());
        	localStorage.setItem('eas-password', $("#password").val());
        	localStorage.setItem('eas-remember', true);
    	}else{
    		localStorage.removeItem('eas-username');
    		localStorage.removeItem('eas-password');
    		localStorage.removeItem('eas-remember');
    	}
	}
    
	function selectLang(lang){
		_setI18n(lang);
		window.location.reload();
	}
	
	function myMsgcodeButton(){
		var userNo=$("#username").val();
		ajax(ctx+"/sys/auth/login/validate/msgcode",{userNo:userNo},function(result){
			if(result.success){
				// 按钮时间
				var num=30;
				setInterval(function(){
					num--;
					if(num>0){
						$("#my_msgcode_button").html(num+"秒");
						$("#my_msgcode_button").attr("disabled","disabled");
					}else if(num==0){
						$("#my_msgcode_button").html("获取");
						$("#my_msgcode_button").removeAttr("disabled");
					}
				},1000);
			}else{
				bootbox.alert("获取验证码失败");
			}
		});
		
	}
	
	function loginTypeclick(loginType){
		if(loginType=='ldap'){
			$("#myMsgcodeDiv").hide();
		}else{
			//默认使用普通登录方式
			$("#myMsgcodeDiv").show();
		}
	}
	//禁止移动端切换
	var jinzhi = 0;
	document.addEventListener("touchmove", function(e) {
		if (jinzhi == 0) {
			e.preventDefault();
			e.stopPropagation();
		}
	}, false);
</script>
</body>
</html>
